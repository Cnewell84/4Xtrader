# Worker Service for live trading
name: forex-trader-worker
type: Backend Service  # Changed from Scheduled Job to Backend Service for batch deployment

image:
  build:
    dockerfile: Dockerfile
    context: .
    target: trading_agent
  command: python live_trading.py
  execution_role: arn:aws:iam::976193254747:role/forex-trader-execution-role

cpu: 1024
memory: 2048
platform: linux/x86_64
count: 1  # Number of tasks to run

variables:
  SYMBOL: USD
  LOT_SIZE: 0.01
  STOP_LOSS: 50
  TAKE_PROFIT: 50
  CHECK_INTERVAL: 60
  RISK_PERCENTAGE: 0.02

secrets:
  OANDA_ACCESS_TOKEN: /forex-trader/oanda/access-token
  OANDA_ACCOUNT_ID: /forex-trader/oanda/account-id
  EMAIL_PASSWORD: /forex-trader/email/password
  TWILIO_AUTH_TOKEN: /forex-trader/twilio/auth-token

storage:
  volumes:
    data:
      path: '/app/data'
      read_only: false
    logs:
      path: '/app/logs'
      read_only: false

# Deployment configuration
deployment:
  rolling:
    cpu_percentage: 50
    memory_percentage: 50
    circuit_breaker:
      enabled: true
      rollback: true