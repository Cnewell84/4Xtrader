# Worker Service for live trading
name: forex-trader-worker
type: Backend Service

image:
  build:
    dockerfile: Dockerfile
    context: .
    target: trading_agent
  command: python live_trading.py
  execution_role: arn:aws:iam::976193254747:role/forex-trader-execution-role

cpu: 1024
memory: 2048
platform: linux/x86_64
count: 1

variables:
  SYMBOL: USD
  LOT_SIZE: 0.01
  STOP_LOSS: 50
  TAKE_PROFIT: 50
  CHECK_INTERVAL: 60
  RISK_PERCENTAGE: 0.02

secrets:
  OANDA_ACCESS_TOKEN:
    secretsmanager: /forex-trader/oanda/access-token
  OANDA_ACCOUNT_ID:
    secretsmanager: /forex-trader/oanda/account-id
  EMAIL_PASSWORD:
    secretsmanager: /forex-trader/email/password
  TWILIO_AUTH_TOKEN:
    secretsmanager: /forex-trader/twilio/auth-token

storage:
  volumes:
    data:
      path: '/app/data'
      read_only: false
    logs:
      path: '/app/logs'
      read_only: false

deployment:
  rolling_update:
    cpu_percentage: 50
    memory_percentage: 50
    circuit_breaker:
      enabled: true
      rollback: true

exec_role_policies:
  - AWSSSMReadOnlyAccess
  - SecretsManagerReadWrite
  - Statement:
      Effect: Allow
      Action:
        - ssm:GetParameters
        - ssm:GetParameter
      Resource:
        - arn:aws:ssm:us-east-2:976193254747:parameter/forex-trader/*
