<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Live Trading Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <!-- Bootstrap CSS for styling -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
    <!-- Chart.js for plotting -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="container mt-4">
        <h1 class="text-center">Live Trading Dashboard</h1>

        <!-- Account Status Panel -->
        <div class="row mt-4">
            <div class="col-md-4">
                <div class="card text-white bg-primary mb-3">
                    <div class="card-header">Account Balance</div>
                    <div class="card-body">
                        <h5 class="card-title" id="account_balance">$0.00</h5>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card text-white bg-success mb-3">
                    <div class="card-header">Equity</div>
                    <div class="card-body">
                        <h5 class="card-title" id="equity">$0.00</h5>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card text-white bg-warning mb-3">
                    <div class="card-header">Open Trades</div>
                    <div class="card-body">
                        <h5 class="card-title" id="open_trades">0</h5>
                    </div>
                </div>
            </div>
        </div>

        <!-- Performance Metrics Panel -->
        <div class="row">
            <div class="col-md-4">
                <div class="card text-white bg-info mb-3">
                    <div class="card-header">Sharpe Ratio</div>
                    <div class="card-body">
                        <h5 class="card-title" id="sharpe_ratio">0.00</h5>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card text-white bg-secondary mb-3">
                    <div class="card-header">Win Rate</div>
                    <div class="card-body">
                        <h5 class="card-title" id="win_rate">0.00%</h5>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card text-white bg-danger mb-3">
                    <div class="card-header">Max Drawdown</div>
                    <div class="card-body">
                        <h5 class="card-title" id="max_drawdown">0.00%</h5>
                    </div>
                </div>
            </div>
        </div>

        <!-- Market Data and Trades Graph -->
        <div class="row mt-4">
            <div class="col-md-12">
                <canvas id="marketChart"></canvas>
            </div>
        </div>
    </div>

    <!-- jQuery and Bootstrap JS for interactivity -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>

    <!-- Custom JavaScript to fetch and display data -->
    <script>
        $(document).ready(function() {
            // Function to update account status
            function updateStatus() {
                $.getJSON('/api/status', function(data) {
                    if (data.error) {
                        console.error(data.error);
                        return;
                    }
                    $('#account_balance').text(`$${parseFloat(data.balance).toFixed(2)}`);
                    $('#equity').text(`$${parseFloat(data.equity).toFixed(2)}`);
                    $('#open_trades').text(data.open_trades);
                });
            }

            // Function to update performance metrics
            function updateMetrics() {
                $.getJSON('/api/status', function(data) {
                    if (data.error) return;
                    // Assuming performance metrics are part of the status
                    $('#sharpe_ratio').text(parseFloat(data.sharpe_ratio).toFixed(2));
                    $('#win_rate').text(`${parseFloat(data.win_rate).toFixed(2)}%`);
                    $('#max_drawdown').text(`${parseFloat(data.max_drawdown).toFixed(2)}%`);
                });
            }

            // Function to update the market chart
            let marketChart;
            function updateMarketChart() {
                $.getJSON('/api/market_data', function(data) {
                    if (data.error) {
                        console.error(data.error);
                        return;
                    }

                    const labels = data.map(entry => entry.time);
                    const prices = data.map(entry => entry.close);

                    if (marketChart) {
                        marketChart.data.labels = labels;
                        marketChart.data.datasets[0].data = prices;
                        marketChart.update();
                    } else {
                        const ctx = document.getElementById('marketChart').getContext('2d');
                        marketChart = new Chart(ctx, {
                            type: 'line',
                            data: {
                                labels: labels,
                                datasets: [{
                                    label: 'Close Price',
                                    data: prices,
                                    borderColor: 'rgba(75, 192, 192, 1)',
                                    borderWidth: 2,
                                    fill: false,
                                    pointRadius: 0
                                }]
                            },
                            options: {
                                responsive: true,
                                title: {
                                    display: true,
                                    text: 'Live Market Data'
                                },
                                scales: {
                                    xAxes: [{
                                        type: 'time',
                                        time: {
                                            unit: 'minute',
                                            displayFormats: {
                                                minute: 'HH:mm'
                                            }
                                        },
                                        distribution: 'series'
                                    }],
                                    yAxes: [{
                                        ticks: {
                                            beginAtZero: false
                                        }
                                    }]
                                }
                            }
                        });
                    }
                });
            }

            // Initial data fetch
            updateStatus();
            updateMetrics();
            updateMarketChart();

            // Set intervals for updating data
            setInterval(updateStatus, 5000);      // Every 5 seconds
            setInterval(updateMetrics, 5000);     // Every 5 seconds
            setInterval(updateMarketChart, 60000); // Every 60 seconds
        });
    </script>
</body>
</html> 